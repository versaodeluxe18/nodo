{
  "version": "1.1",
  "nodes": [
    {
      "id": 1769808373605.4636,
      "x": 215,
      "y": 145,
      "label": "26/01/2026",
      "type": "txt",
      "description": "Inicio do N√ì-DO",
      "code": "\n~~Vis√£o do projeto~~\n\nO N√ì-DO √© um mapeador estrutural de pensamento, sistemas e arquitetura.\n\nO projeto nasce da necessidade pessoal de W.F.Fukuta em organizar, mapear e armazenar processos e estruturas utilizados em seus projetos desenvolvidos para a Vers√£o Deluxe.\n\nEm vez de registrar ideias de forma linear, o N√ì-DO prop√µe um pensamento visual e n√£o linear, onde cada cart√£o representa um elemento do sistema e cada conex√£o explicita uma rela√ß√£o l√≥gica. Isso permite compreender arquiteturas complexas como um todo, e n√£o apenas como partes isoladas.\n\nO N√ì-DO n√£o substitui editores de texto ou c√≥digo. Ele atua como uma camada estrutural, ajudando a planejar, entender e evoluir projetos antes, durante e depois da execu√ß√£o.\n\n\n\n\n\n\n"
    },
    {
      "id": 1769858549724.332,
      "x": 865,
      "y": 290,
      "label": "31/01/2026 /",
      "type": "txt",
      "description": "Disponibilizado site do projeto",
      "code": "~~Site N√ì-DO~~\n\nFoi criado um site para apresentar o projeto N√≥do.\n\nSite: https://sites.google.com/view/no-do\n"
    },
    {
      "id": 1769845745774.624,
      "x": 866,
      "y": 179,
      "label": "29/01/2026 /",
      "type": "txt",
      "description": "Dispon√≠bilizado Reposit√≥rio GitHub",
      "code": "\n~~Reposit√≥rio no GitHub~~\n\nO projeto N√ì-DO foi disponibilizado no reposit√≥rio da Vers√£o DEluxe.\n\nReposit√≥rio: https://github.com/versaodeluxe18/nodo"
    },
    {
      "id": 1769810512656.7898,
      "x": 520,
      "y": 227.5,
      "label": "üß∂ N√ì-DO 1.0 /",
      "type": "novelo",
      "description": "",
      "code": "// C√≥digo para üß∂ N√ì-DO 1.0 /\n",
      "isNovelo": true,
      "noveloId": "1769810508992"
    }
  ],
  "connections": [
    {
      "from": 1769808373605.4636,
      "to": 1769810512656.7898
    },
    {
      "from": 1769858549724.332,
      "to": 1769810512656.7898
    },
    {
      "from": 1769810512656.7898,
      "to": 1769845745774.624
    }
  ],
  "devLogs": [
    {
      "date": "03/02/2026",
      "time": "06:27:47",
      "type": "atualiza√ß√£o",
      "text": "Foi removido da vers√£o 1.0 a integra√ß√£o com o google drive."
    },
    {
      "date": "02/02/2026",
      "time": "11:35:42",
      "type": "problema",
      "text": "GOOGLE DRIVE apresenta muitos erros e faz constantes exigencias que n√£o s√£o boas para projetos pequenos."
    }
  ],
  "novelos": [
    {
      "id": "1769810508992",
      "name": "N√ì-DO 1.0 /",
      "description": "Lan√ßado primeira vers√£o",
      "nodes": [
        {
          "id": 1770109129679.6843,
          "x": 972,
          "y": 219,
          "label": "Salvar em Json / ",
          "type": "js",
          "description": "SALVANDO PROJETO",
          "code": "üíæ SALVAR\n\nO projeto passa a ser salvo em JSON.\n\nCart√µes, conex√µes, novelos e estados s√£o preservados.\n\nO mapa vira um artefato vivo."
        },
        {
          "id": 1770109350358.047,
          "x": 989,
          "y": 84,
          "label": "Desfazer / ",
          "type": "txt",
          "description": "DESFAZER MERDAS",
          "code": "Desfazer atrav√©s do [CTRL]+[Z] se torna necess√°rio, junto com essa nova funcionalidade foi colocado um hist√≥rico de a√ß√µes.\n"
        },
        {
          "id": 1770109264969.4072,
          "x": 830,
          "y": -83,
          "label": "W.F.Fukuta / ",
          "type": "txt",
          "description": "DEV",
          "code": "Desenvolvedor apoiador do projeto [N√ì]~[DO]\n\nhttps://github.com/wffukuta"
        },
        {
          "id": 1770110471040.3567,
          "x": 640,
          "y": 52,
          "label": "VERS√ÉO 1.0 / ",
          "type": "txt",
          "description": "",
          "code": "Primeira vers√£o do [N√ì]~[DO] foi lan√ßado no dia 26/01/2026 sendo criado integralmente por W.F.Fukuta para os projetos da organiza√ß√£o Vers√£o DEluxe."
        },
        {
          "id": 1770108486216.0203,
          "x": 273,
          "y": 91,
          "label": "Ideia inicial / ",
          "type": "txt",
          "description": "TUDO COME√áA AQUI",
          "code": "\nüí° TUDO COME√áA AQUI\n\nA ideia do N√ì-DO surgiu da necessidade de organizar sistemas de jogos e projetos de forma visual.\n\nDocumentos lineares n√£o davam conta da complexidade do pensamento.\n\nA solu√ß√£o: pensar em n√≥s conectados."
        },
        {
          "id": 1770109007896.298,
          "x": 864,
          "y": 341,
          "label": "Novelos / ",
          "type": "txt",
          "description": "CRIADO NOVELOS",
          "code": "Com muitos cart√µes, o mapa fica polu√≠do.\n\nIdeias relacionadas ficam espalhadas.\n\nSurge a necessidade de agrupar conceitos.\n\nNasce o NOVELO.\n\nUm n√≥ especial que representa um conjunto de ideias.\n\nEle funciona como um submapa.\n\nOrganiza√ß√£o sem perder profundidade."
        },
        {
          "id": 1770110982675.0894,
          "x": 648,
          "y": 349,
          "label": "DevLogs / ",
          "type": "txt",
          "description": "",
          "code": "// C√≥digo para DevLogs / \n"
        },
        {
          "id": 1770111159066.7163,
          "x": 46,
          "y": 292,
          "label": "C√ìDIGO",
          "type": "js",
          "description": " Base do N√≥do",
          "code": "<!DOCTYPE html>\n<html lang=\"pt-br\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>N√ì-DO</title>\n    <style>\n        \n        body {\n            margin: 0;\n            overflow: hidden;\n            background-color: #1e1e1e;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            color: #ccc;\n        }\n\n        /* Barra de Ferramentas Superior */\n        #toolbar {\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            background: #252526;\n            padding: 10px;\n            border-radius: 5px;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.3);\n            z-index: 10;\n            display: flex;\n            gap: 10px;\n            align-items: center;\n        }\n\n        button {\n            background: #0e639c;\n            color: white;\n            border: none;\n            padding: 8px 12px;\n            cursor: pointer;\n            border-radius: 3px;\n            font-weight: bold;\n            font-size: 13px;\n            transition: background 0.2s;\n        }\n\n        button:hover { background: #1177bb; }\n        \n        button.secondary { background: #3c3c3c; }\n        button.secondary:hover { background: #4c4c4c; }\n\n        button.success { background: #3c3c3c; }\n        button.success:hover { background: #4c4c4c; }\n\n        button.warning { background: #3c3c3c; color: #fff; }\n        button.warning:hover { background: #4c4c4c; }\n\n        /* Separador visual na toolbar */\n        .separator {\n            width: 1px;\n            height: 25px;\n            background: #555;\n            margin: 0 5px;\n        }\n\n        /* O Canvas Principal */\n        canvas {\n            display: block;\n            cursor: grab;\n        }\n        canvas:active { cursor: grabbing; }\n\n        /* Painel Lateral de C√≥digo */\n        #code-panel {\n            position: absolute;\n            top: 0;\n            right: -550px; /* Escondido inicialmente */\n            width: 500px;\n            height: 100vh;\n            background: #252526;\n            border-left: 1px solid #333;\n            transition: right 0.3s cubic-bezier(0.075, 0.82, 0.165, 1);\n            display: flex;\n            flex-direction: column;\n            z-index: 20;\n            box-shadow: -5px 0 15px rgba(0,0,0,0.5);\n        }\n\n        #code-panel.active { right: 0; }\n\n        .panel-header {\n            padding: 15px;\n            background: #333;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            border-bottom: 1px solid #1e1e1e;\n        }\n\n        .panel-header h3 { margin: 0; color: #fff; font-size: 16px; }\n\n        #code-editor {\n            flex: 1;\n            background: #1e1e1e;\n            color: #d4d4d4;\n            border: none;\n            padding: 15px;\n            font-family: 'Consolas', 'Courier New', monospace;\n            font-size: 14px;\n            resize: none;\n            outline: none;\n            line-height: 1.5;\n        }\n\n        .close-btn {\n            background: transparent;\n            color: #fff;\n            font-size: 20px;\n            padding: 0 10px;\n        }\n        .close-btn:hover { background: #444; }\n        \n        .instruction {\n            position: absolute;\n            bottom: 10px;\n            left: 10px;\n            color: #666;\n            font-size: 12px;\n            pointer-events: none;\n            user-select: none;\n        }\n\n                \n#file-type {\n    background: #1e1e1e;\n    color: #d4d4d4;\n    border: 1px solid #3c3c3c;\n    padding: 6px 8px;\n    margin: 10px;\n    font-family: 'Segoe UI', Tahoma, sans-serif;\n    font-size: 13px;\n    outline: none;\n}\n\n#file-type option {\n    background: #1e1e1e;\n    color: #d4d4d4;\n}\n\n    </style>\n\n\n\n\n    \n</head>\n<body>\n\n    <div id=\"toolbar\">\n        <button onclick=\"addNode()\">+ NOVO CART√ÉO</button>\n        <button class=\"secondary\" onclick=\"connectNodes()\">LIGAR</button>\n        <button class=\"secondary\" onclick=\"unlinkSelectedNodes()\">DESLIGAR</button>\n\n        \n        <div class=\"separator\"></div>\n\n        <button class=\"success\" onclick=\"exportProject()\">üíæ</button>\n        <button id=\"openBtn\" class=\"warning\">üìÇ</button>\n        </div>\n\n\n        <!-- MENU SUSPENSO DE ABERTURA -->\n        <div id=\"openMenu\" style=\"\n  position:absolute;\n  top:55px;\n  left:10px;\n  background:#252526;\n  border:1px solid #333;\n  border-radius:4px;\n  display:none;\n  flex-direction:column;\n  min-width:220px;\n  z-index:100;\n  box-shadow:0 6px 20px rgba(0,0,0,.4);\n\">\n  <button class=\"secondary\" onclick=\"openLocalFile()\">üìÇ Arquivo local</button>          \n  <button class=\"secondary\" onclick=\"openFromGithub()\">üîó GitHub (RAW)</button>        \n  <button class=\"secondary\" onclick=\"openProjetoNodo()\">üöÄ Projeto N√≥-do</button>\n</div>\n\n\n    \n\n    <input type=\"file\" id=\"fileInput\" style=\"display: none;\" accept=\".json\" onchange=\"importProject(this)\">\n\n    <div class=\"instruction\">\n        Vers√£o DEluxe | W.F.Fukuta | V: 1.0\n    </div>\n\n    <canvas id=\"gameMap\"></canvas>\n\n  <div id=\"code-panel\">\n\n  <div class=\"panel-header\">\n      <h3 id=\"panel-title\">Editor</h3>\n      <button class=\"close-btn\" onclick=\"closePanel()\">√ó</button>          \n  </div>\n\n\n\n\n      \n\n  <!-- TIPO DE ARQUIVO -->\n  <select id=\"file-type\" onchange=\"changeFileType(this.value)\">\n      <option value=\"js\">js</option>\n      <option value=\"html\">html</option>\n      <option value=\"css\">css</option>\n      <option value=\"json\">json</option>\n      <option value=\"txt\">txt</option>\n  </select>\n\n  <!-- DESCRI√á√ÉO FIXA -->\n  <textarea\n      id=\"description-editor\"\n      placeholder=\"Descri√ß√£o do arquivo (aparece no card)...\"\n      style=\"\n        margin: 0 10px 10px 10px;\n        height: 70px;\n        background: #1e1e1e;\n        color: #ccc;\n        border: 1px solid #333;\n        padding: 8px;\n        resize: none;\n        font-size: 13px;\n        outline: none;\n      \"\n  ></textarea>\n\n  <!-- C√ìDIGO -->\n  <textarea id=\"code-editor\" placeholder=\"// Escreva seu c√≥digo aqui...\"></textarea>\n\n</div>\n\n\n\n\n\n\n    \n    <script>     \n        const canvas = document.getElementById('gameMap');\n        const ctx = canvas.getContext('2d');\n        canvas.addEventListener(\"contextmenu\", e => e.preventDefault());\n        const codePanel = document.getElementById('code-panel');\n        const codeEditor = document.getElementById('code-editor');\n        const panelTitle = document.getElementById('panel-title');\n\n        // Estado da Aplica√ß√£o\n        // Alterado de 'let' para 'var' para garantir escopo global no window\n        var nodes = [];\n        var connections = [];\n        var novelos = []; // <--- AGORA GLOBAL DE VERDADE\n        var devLogs = []; // <--- GLOBAL PARA LOGS\n        var selectedNodes = [];\n        \n        let isPanning = false;\n        let isDragging = false;\nlet dragTarget = null;\nlet offsetX = 0;\nlet offsetY = 0;\n\nlet panStartX = 0;\nlet panStartY = 0;\n\n        let activeNode = null; // N√≥ sendo editado no painel\n\n        // Configura√ß√£o do Canvas\n        function resizeCanvas() {\n            canvas.width = window.innerWidth;\n            canvas.height = window.innerHeight;\n            draw();\n        }\n        window.addEventListener('resize', resizeCanvas);\n\n        // Classe N√≥ (Representa um arquivo)\n      class Node {\n    constructor(x, y, label, type = 'js', id = null) {\n        this.id = id || (Date.now() + Math.random());\n        this.x = x;\n        this.y = y;\n        this.width = 160;\n        this.height = 95;\n\n        this.label = label;\n        this.type = type;\n        this.description = '';\n        this.color = '#3c3c3c';\n\n        this.code = `// C√≥digo para ${label}\\n`;\n    }\n\n\n            draw(ctx, isSelected) {\n                // Sombra para profundidade\n                ctx.shadowColor = 'rgba(0,0,0,0.5)';\n                ctx.shadowBlur = 15;\n                \n                // Fundo do N√≥\n                ctx.fillStyle = isSelected ? '#094771' : this.color; // Azul mais escuro quando selecionado\n                ctx.fillRect(this.x, this.y, this.width, this.height);\n                \n                // Borda\n                ctx.strokeStyle = isSelected ? '#007acc' : '#555'; // Borda azul VSCode quando selecionado\n                ctx.lineWidth = isSelected ? 2 : 1;\n                ctx.strokeRect(this.x, this.y, this.width, this.height);\n                \n                ctx.shadowBlur = 0; // Reset sombra\n\n                // Cabe√ßalho (Barra superior do n√≥)\n                ctx.fillStyle = 'rgba(255,255,255,0.05)';\n                ctx.fillRect(this.x, this.y, this.width, 25);\n\n                // Texto do T√≠tulo\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 13px Segoe UI';\n                ctx.fillText(`${this.label}.${this.type}`, this.x + 10, this.y + 17);\n\n\n\n                // Indicador de conte√∫do\n                ctx.fillStyle = '#888';\n                ctx.fillStyle = '#aaa';\nctx.font = '11px Segoe UI';\n\nctx.fillStyle = '#aaa';\nctx.font = '11px Segoe UI';\n\nconst desc = this.description || 'Sem descri√ß√£o';\n\ndrawMultilineText(\n    ctx,\n    desc,\n    this.x + 10,\n    this.y + 45,\n    this.width - 20,\n    14,\n    3\n);\n\n            }\n\n            isPointInside(x, y) {\n                return x >= this.x && x <= this.x + this.width &&\n                       y >= this.y && y <= this.y + this.height;\n            }\n        }\n\n        // --- FUNCIONALIDADES DE ARQUIVO (EXPORTAR/IMPORTAR) ---\n\n        function exportProject() {\n            if (nodes.length === 0) {\n                alert(\"Nada para salvar!\");\n                return;\n            }\n\n            // Criar objeto de dados Serializ√°vel\n            // Convertemos as conex√µes de refer√™ncias de objetos para IDs\n            const projectData = {\n                version: \"1.0\",\n               nodes: nodes.map(n => ({\n    id: n.id,\n    x: n.x,\n    y: n.y,\n    label: n.label,\n    type: n.type,\n    description: n.description,\n    code: n.code\n})),\nconnections: connections.map(c => ({\n    from: c.from.id,\n    to: c.to.id\n})),\n                novelos: novelos // Inclui os novelos no export original\n            };\n\n            const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(projectData, null, 2));\n            const downloadAnchorNode = document.createElement('a');\n            downloadAnchorNode.setAttribute(\"href\", dataStr);\n            downloadAnchorNode.setAttribute(\"download\", \"arquitetura_jogo.json\");\n            document.body.appendChild(downloadAnchorNode); // Necess√°rio para Firefox\n            downloadAnchorNode.click();\n            downloadAnchorNode.remove();\n        }\n\n\n        function importProject(inputElement) {\n            const file = inputElement.files[0];\n            if (!file) return;\n\n            \n            const reader = new FileReader();\n            reader.onload = function(e) {\n                try {\n                    const data = JSON.parse(e.target.result);\n                    \n                    loadProjectData(data);\n                    alert(\"Projeto carregado com sucesso!\");\n\n                } catch (err) {\n                    alert(\"Erro ao carregar arquivo: Formato inv√°lido.\");\n                    console.error(err);\n                }\n                // Limpar o input para permitir carregar o mesmo arquivo novamente se necess√°rio\n                inputElement.value = '';\n            };\n            reader.readAsText(file);\n        }\n\n\n        function loadProjectData(data) {\n  nodes.length = 0;\n  connections.length = 0;\n  selectedNodes.length = 0;\n\n  // Restaurar nodes\n  data.nodes.forEach(n => {\n    const node = new Node(n.x, n.y, n.label, n.type, n.id);\n    node.description = n.description || \"\";\n    node.code = n.code || \"\";\n    \n    // Propriedades de Novelo\n    if (n.isNovelo) {\n        node.isNovelo = true;\n        node.noveloId = n.noveloId;\n    }\n    \n    nodes.push(node);\n  });\n\n  // Restaurar conex√µes\n  data.connections.forEach(c => {\n    const from = nodes.find(n => n.id === c.from);\n    const to = nodes.find(n => n.id === c.to);\n    if (from && to) connections.push({ from, to });\n  });\n\n  // Restaurar DevLogs\n  if (data.devLogs) {\n    devLogs = data.devLogs;\n  } else {\n    devLogs = [];\n  }\n  \n  // Restaurar Novelos\n  if (data.novelos) {\n    novelos = data.novelos;\n  } else {\n    novelos = [];\n  }\n\n  // Atualizar UI de novelos se dispon√≠vel\n  if (window.renderNovelos) window.renderNovelos();\n  // Atualizar UI de logs se dispon√≠vel\n  if (window.renderDevLogs) window.renderDevLogs();\n\n  draw();\n}\n\n        // --- GERENCIAMENTO DE N√ìS ---\n\n        function addNode() {\n            const name = prompt(\"Nome do novo cart√£o\", \"NewSystem\");\n            if (name) {\n                // Posiciona levemente deslocado para n√£o ficar um em cima do outro\n                const offset = nodes.length * 20;\n                const node = new Node(100 + offset, 100 + offset, name);\n                nodes.push(node);\n                draw();\n            }\n        }\n\n        function connectNodes() {\n            if (selectedNodes.length === 2) {\n                const exists = connections.some(c => \n                    (c.from === selectedNodes[0] && c.to === selectedNodes[1]) ||\n                    (c.from === selectedNodes[1] && c.to === selectedNodes[0])\n                );\n                \n                if (!exists) {\n                    connections.push({ from: selectedNodes[0], to: selectedNodes[1] });\n                }\n                clearSelection();\n                draw();\n            } else {\n                alert(\"Selecione exatamente 2 cart√µes para ligar o n√≥. (Shift + Clique).\");\n            }\n        }\n\n\n        function unlinkSelectedNodes() {\n    if (selectedNodes.length === 2) {\n        connections = connections.filter(c =>\n            !(\n                (c.from === selectedNodes[0] && c.to === selectedNodes[1]) ||\n                (c.from === selectedNodes[1] && c.to === selectedNodes[0])\n            )\n        );\n        clearSelection();\n        draw();\n    } else {\n        alert(\"Selecione exatamente 2 cart√µes para desligar o n√≥.\");\n    }\n}\n\n\nfunction hasConnection(a, b) {\n  return connections.some(c =>\n    (c.from === a && c.to === b) ||\n    (c.from === b && c.to === a)\n  );\n}\n\nfunction toggleConnection(a, b) {\n  if (hasConnection(a, b)) {\n    // ===== DESLIGAR =====\n    connections = connections.filter(c =>\n      !(\n        (c.from === a && c.to === b) ||\n        (c.from === b && c.to === a)\n      )\n    );\n\n    // feedback visual de remo√ß√£o\n    playLinkEffect(a, b, \"unlink\");\n\n  } else {\n    // ===== LIGAR =====\n    connections.push({ from: a, to: b });\n\n    // feedback visual de cria√ß√£o\n    playLinkEffect(a, b, \"link\");\n  }\n}\n        \n\n        function clearSelection() {\n            selectedNodes = [];\n            closePanel(); // Fecha o painel de edi√ß√£o tamb√©m, para dar feedback visual claro\n            draw();\n        }\n\n\n        function deleteSelectedNodes() {\n  if (selectedNodes.length === 0) return;\n\n  // Remove conex√µes ligadas aos n√≥s selecionados\n  connections = connections.filter(c =>\n    !selectedNodes.includes(c.from) &&\n    !selectedNodes.includes(c.to)\n  );\n\n  // Remove os n√≥s\n  nodes = nodes.filter(n => !selectedNodes.includes(n));\n\n  // Limpa sele√ß√£o e painel\n  selectedNodes = [];\n  closePanel();\n\n  draw();\n}\n\n\n        function drawMultilineText(ctx, text, x, y, maxWidth, lineHeight, maxLines = 3) {\n    const words = text.split(' ');\n    let line = '';\n    let lines = [];\n\n    for (let n = 0; n < words.length; n++) {\n        const testLine = line + words[n] + ' ';\n        const metrics = ctx.measureText(testLine);\n\n        if (metrics.width > maxWidth && n > 0) {\n            lines.push(line);\n            line = words[n] + ' ';\n        } else {\n            line = testLine;\n        }\n    }\n    lines.push(line);\n\n    if (lines.length > maxLines) {\n        lines = lines.slice(0, maxLines);\n        lines[maxLines - 1] = lines[maxLines - 1].trim() + '‚Ä¶';\n    }\n\n    lines.forEach((l, i) => {\n        ctx.fillText(l, x, y + i * lineHeight);\n    });\n}\n\n\n        // --- RENDERIZA√á√ÉO ---\n\n        function draw() {\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            drawGrid();\n\n            // Desenhar Conex√µes\n            ctx.strokeStyle = '#666';\n            ctx.lineWidth = 2;\n            connections.forEach(conn => {\n                const startX = conn.from.x + conn.from.width / 2;\n                const startY = conn.from.y + conn.from.height / 2;\n                const endX = conn.to.x + conn.to.width / 2;\n                const endY = conn.to.y + conn.to.height / 2;\n\n                ctx.beginPath();\n                ctx.moveTo(startX, startY);\n                // Curva suave\n                const cp1x = startX + (endX - startX) / 2;\n                const cp1y = startY;\n                const cp2x = startX + (endX - startX) / 2;\n                const cp2y = endY;\n                ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);\n                ctx.stroke();\n            });\n\n            // Desenhar N√≥s\n            nodes.forEach(node => {\n                const isSelected = selectedNodes.includes(node);\n                node.draw(ctx, isSelected);\n            });\n        }\n\n        function drawGrid() {\n            ctx.strokeStyle = '#2e2e2e';\n            ctx.lineWidth = 1;\n            const gridSize = 40;\n            \n            ctx.beginPath();\n            for(let x=0; x<canvas.width; x+=gridSize) {\n                ctx.moveTo(x, 0);\n                ctx.lineTo(x, canvas.height);\n            }\n            for(let y=0; y<canvas.height; y+=gridSize) {\n                ctx.moveTo(0, y);\n                ctx.lineTo(canvas.width, y);\n            }\n            ctx.stroke();\n        }\n\n        // --- INTERA√á√ÉO (MOUSE) ---\n\n       canvas.addEventListener('mousedown', (e) => {\n    const mouseX = e.clientX;\n    const mouseY = e.clientY;\n\n    dragTarget = null;\n\n    // Verifica se clicou em algum n√≥ (de cima pra baixo)\n    for (let i = nodes.length - 1; i >= 0; i--) {\n        if (nodes[i].isPointInside(mouseX, mouseY)) {\n            dragTarget = nodes[i];\n            break;\n        }\n    }\n\nif (e.button === 2) {\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  const target = nodes.find(n => n.isPointInside(mouseX, mouseY));\n  if (!target) return;\n\n  if (selectedNodes.length !== 1) return;\n\n  const baseNode = selectedNodes[0];\n  if (baseNode === target) return;\n\n  toggleConnection(baseNode, target);\n  draw();\n  return;\n}\n\n    if (dragTarget) {\n        // ===== MOVE N√ì =====\n        isDragging = true;\n        offsetX = mouseX - dragTarget.x;\n        offsetY = mouseY - dragTarget.y;\n\n        if (e.shiftKey) {\n            if (selectedNodes.includes(dragTarget)) {\n                selectedNodes = selectedNodes.filter(n => n !== dragTarget);\n            } else {\n                selectedNodes.push(dragTarget);\n            }\n        } else {\n            if (!selectedNodes.includes(dragTarget)) {\n                selectedNodes = [dragTarget];\n                if (activeNode && activeNode !== dragTarget) {\n                    openCodePanel(dragTarget);\n                }\n            }\n        }\n\n        // traz para frente\n        const index = nodes.indexOf(dragTarget);\n        if (index > -1) {\n            nodes.splice(index, 1);\n            nodes.push(dragTarget);\n        }\n\n        draw();\n    } else {\n        // ===== MOVE FUNDO =====\n        isPanning = true;\n        panStartX = mouseX;\n        panStartY = mouseY;\n\n        if (!e.shiftKey) {\n            clearSelection();\n        }\n    }\n});\n\n       canvas.addEventListener('mousemove', (e) => {\n    const mouseX = e.clientX;\n    const mouseY = e.clientY;\n\n    // ===== PAN DO FUNDO =====\n    if (isPanning) {\n        const dx = mouseX - panStartX;\n        const dy = mouseY - panStartY;\n\n        nodes.forEach(node => {\n            node.x += dx;\n            node.y += dy;\n        });\n\n        panStartX = mouseX;\n        panStartY = mouseY;\n\n        draw();\n        return;\n    }\n\n    // ===== MOVE N√ì =====\n    if (isDragging && dragTarget) {\n        if (selectedNodes.includes(dragTarget) && selectedNodes.length > 1) {\n            const deltaX = mouseX - (dragTarget.x + offsetX);\n            const deltaY = mouseY - (dragTarget.y + offsetY);\n\n            selectedNodes.forEach(node => {\n                node.x += deltaX;\n                node.y += deltaY;\n            });\n\n            offsetX = mouseX - dragTarget.x;\n            offsetY = mouseY - dragTarget.y;\n        } else {\n            dragTarget.x = mouseX - offsetX;\n            dragTarget.y = mouseY - offsetY;\n        }\n\n        draw();\n    }\n});\n\n\n        canvas.addEventListener('mouseup', () => {\n    isDragging = false;\n    isPanning = false;\n    dragTarget = null;\n});\n\n\n\n        \n   canvas.addEventListener('dblclick', (e) => {\n  const mouseX = e.clientX;\n  const mouseY = e.clientY;\n\n  const target = nodes.find(n => n.isPointInside(mouseX, mouseY));\n  if (!target) return;\n\n  // SE FOR NOVELO ‚Üí ABRE PAINEL DE NOVELOS\n  if (target.isNovelo) {\n    const panel = document.getElementById(\"novelo-panel\");\n    panel.style.right = \"0px\";\n    return;\n  }\n\n  // SE FOR CARD NORMAL ‚Üí ABRE EDITOR\n  openCodePanel(target);\n});\n\n\n\n\n\n\ncanvas.addEventListener(\"click\", (e) => {\n  if (isDragging || isPanning) return;\n  if (activeNovelo) return;\n\n  const rect = canvas.getBoundingClientRect();\n  const mx = e.clientX - rect.left;\n  const my = e.clientY - rect.top;\n\n  const target = nodes.find(n => n.isPointInside(mx, my));\n  if (!target) {\n    removeEnterNoveloButton();\n    return;\n  }\n\n  // CARD DE NOVELO ‚Üí MOSTRA BOT√ÉO\n  if (target.isNovelo) {\n    showEnterNoveloButton(target.noveloId);\n    return;\n  }\n\n  // CARD NORMAL ‚Üí esconde bot√£o\n  removeEnterNoveloButton();\n});\n\n\n\n\n        \n\n\n        window.addEventListener(\"keydown\", e => {\n  if (e.key === \"Delete\") {\n    // evita apagar enquanto digita no editor\n    if (document.activeElement === codeEditor) return;\n\n    deleteSelectedNodes();\n  }\n});\n       \n        \n        const openBtn = document.getElementById(\"openBtn\");\nconst openMenu = document.getElementById(\"openMenu\");\n\nopenBtn.onclick = () => {\n  const rect = openBtn.getBoundingClientRect();\n\n  openMenu.style.top = rect.bottom + 5 + \"px\";\n  openMenu.style.left = rect.left + \"px\";\n\n  openMenu.style.display =\n    openMenu.style.display === \"flex\" ? \"none\" : \"flex\";\n};\n\ndocument.addEventListener(\"click\", e => {\n  if (!openBtn.contains(e.target) && !openMenu.contains(e.target)) {\n    openMenu.style.display = \"none\";\n  }\n});\n\n\n\n        \n\n        // --- PAINEL DE C√ìDIGO ---\n\n     function openCodePanel(node) {\n    activeNode = node;\n    updatePanelTitle();\n    codeEditor.value = node.code;\n    document.getElementById('description-editor').value = node.description || '';\n    document.getElementById('file-type').value = node.type;\n    codePanel.classList.add('active');\n}\n\n\n        function updatePanelTitle() {\n    if (!activeNode) return;\n    panelTitle.innerText = `${activeNode.label}.${activeNode.type}`;\n}\n     \n\n\n        function changeFileType(type) {\n    if (!activeNode) return;\n\n    activeNode.type = type;\n    updatePanelTitle();\n}\n\n\n        function closePanel() {\n    codePanel.classList.remove('active');\n\n    if (activeNode) {\n        activeNode.code = codeEditor.value;\n    }\n\n    activeNode = null;\n    document.getElementById('file-type').value = 'js';\n    codeEditor.blur();\n}\n        \n        codeEditor.addEventListener('input', (e) => {\n            if (activeNode) {\n                activeNode.code = e.target.value;\n            }\n        });\n\n\n        const descriptionEditor = document.getElementById('description-editor');\n\ndescriptionEditor.addEventListener('input', e => {\n    if (activeNode) {\n        activeNode.description = e.target.value;\n        draw(); // atualiza o texto do card em tempo real\n    }\n});\n\n        // Inicializa√ß√£o\n        resizeCanvas();\n        \n        // Exemplo inicial se vazio\n        if(nodes.length === 0) {\n            const n1 = new Node(375, 161,\"LEIA / README\", \"txt\");\n            n1.description = \"üôãüèª‚Äç‚ôÇÔ∏è Bem-Vindo, amigo!\";\n            n1.code = ` ~~INSTRU√á√ïES PRA USAR O N√ì-DO~~\\n\\nüñ±Ô∏è CLIQUE DUPLO: abrir cart√£o\\nüñ±Ô∏è CLIQUE DIREITO: liga ou desliga n√≥ \\nüñ±Ô∏è SHIFT: selecionar v√°rios\\nüñ±Ô∏è ARRASTAR: mover o mapa\\nüñ±Ô∏è DELETE: apaga cart√£o\\n__________\\nüìÇ ABRIR: Abrir um projeto\\nüíæ SALVAR: Salvar o projeto\\nüìù DEVLOG: Registrar o fluxo\\nüß∂ NOVELO: Criar novo mapa\n__________            \n‚å®Ô∏è CTRL+Z: Desfazer a√ß√µes\n        `;\n            const n2 = new Node(777, 272, \"VERS√ÉO\", \"txt\");\n            n2.description = \"üöÄ V:1.0\";\n            n2.code = `~~INFORMA√á√ïES DESSA VERS√ÉO~~\\n\\n- NOVIDADES:\\n- Essa √© a primeira vers√£o de N√≥-do, portanto tudo √© novidade e estamos constantemente \\nmelhorando o nosso projeto.\\n\\n`;\n            nodes.push(n1, n2);\n            connections.push({from: n1, to: n2});\n            draw();\n        }\n\n\n\n        function openLocalFile() {\n  openMenu.style.display = \"none\";\n  document.getElementById(\"fileInputÿ¥ŸÜÿ®Ÿá\").click();\n}\n\n// Corre√ß√£o no ID do input no HTML estava fileInput\nfunction openLocalFile() {\n    openMenu.style.display = \"none\";\n    document.getElementById(\"fileInput\").click();\n}\n\nasync function openFromGithub() {\n  openMenu.style.display = \"none\";\n\n  const url = prompt(\"Cole o link RAW do JSON do GitHub:\");\n  if (!url) return;\n\n  try {\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(\"Erro ao baixar arquivo\");\n\n    const data = await res.json();\n    loadProjectData(data);\n  } catch (err) {\n    alert(\"Erro ao abrir projeto do GitHub\");\n    console.error(err);\n  }\n}\n\n\n\n\n\n// ABRIR O NODE DO NODE\n        async function openProjetoNodo() {\n  openMenu.style.display = \"none\";\n\n  const NODO_JSON_URL = \"https://raw.githubusercontent.com/versaodeluxe18/nodo/main/examples/save-nodo.json\";\n\n  try {\n    const res = await fetch(NODO_JSON_URL);\n    if (!res.ok) throw new Error(\"Erro ao carregar Projeto N√≥-do\");\n\n    const data = await res.json();\n    loadProjectData(data);\n\n  } catch (err) {\n    alert(\"N√£o foi poss√≠vel carregar o Projeto N√≥-do üöß\");\n    console.error(err);\n  }\n}\n    </script>"
        },
        {
          "id": 1770110274840.6711,
          "x": 964,
          "y": 460,
          "label": "C√ìDIGO",
          "type": "js",
          "description": "Blocos de Script",
          "code": " <script>\n/* ==========================================\n   NOVELO ‚Äî SISTEMA DE CENAS / MAPAS\n========================================== */\n\n(function () {\n\n  /* ---------- ESTADO ---------- */\n  // let novelos = []; // REMOVIDO: Usar vari√°vel global 'novelos' definida no script principal (agora var novelos)\n  let activeNovelo = null;\n  let mainMapBackup = null;\n\n  /* ---------- BOT√ÉO TOOLBAR ---------- */\n  const toolbar = document.getElementById(\"toolbar\");\n\n  const noveloBtn = document.createElement(\"button\");\n  noveloBtn.textContent = \"üß∂\";\n  noveloBtn.className = \"secondary\";\n  noveloBtn.onclick = toggleNoveloPanel;\n\n  toolbar.appendChild(noveloBtn);\n\n  /* ---------- PAINEL DE NOVELOS ---------- */\n  const panel = document.createElement(\"div\");\n  panel.id = \"novelo-panel\";\n  panel.style.cssText = `\n    position:absolute;\n    top:0;\n    right:-420px;\n    width:400px;\n    height:100vh;\n    background:#252526;\n    border-left:1px solid #333;\n    display:flex;\n    flex-direction:column;\n    transition:right .3s ease;\n    z-index:40;\n    box-shadow:-5px 0 15px rgba(0,0,0,.5);\n  `;\n\n  panel.innerHTML = `\n    <div style=\"padding:15px;background:#333;display:flex;justify-content:space-between;\">\n      <strong>üß∂ NOVELOS</strong>\n      <button style=\"background:none;color:#fff;font-size:20px;\"\n        onclick=\"document.getElementById('novelo-panel').style.right='-420px'\">√ó</button>\n    </div>\n\n    <div style=\"padding:10px;\">\n      <input id=\"novelo-name\" placeholder=\"Nome do novelo\"\n        style=\"width:100%;margin-bottom:6px;background:#1e1e1e;color:#ccc;border:1px solid #333;padding:6px\">\n      <textarea id=\"novelo-desc\" placeholder=\"Descri√ß√£o\"\n        style=\"width:100%;height:60px;background:#1e1e1e;color:#ccc;border:1px solid #333;padding:6px\"></textarea>\n      <button\n  id=\"novelo-create\"\n  class=\"success\"\n  style=\"width:100%;margin-top:6px;background:#0e639c;\"\n  onmouseover=\"this.style.background='#1177bb'\"\n  onmouseout=\"this.style.background='#0e639c'\"\n>\n  CRIAR\n</button>\n\n    </div>\n\n    <div id=\"novelo-list\" style=\"flex:1;overflow:auto;padding:10px;font-size:13px;\"></div>\n  `;\n\n  document.body.appendChild(panel);\n\n  /* ---------- FUN√á√ïES ---------- */\n  function toggleNoveloPanel() {\n    panel.style.right = panel.style.right === \"0px\" ? \"-420px\" : \"0px\";\n    renderNovelos();\n  }\n\n  function renderNovelos() {\n    const box = document.getElementById(\"novelo-list\");\n\n    // Usa a vari√°vel global 'novelos' (agora segura pois √© var)\n    box.innerHTML = (window.novelos || novelos).map(n => `\n      <div style=\"border:1px solid #333;padding:8px;margin-bottom:8px;\">\n        <strong>üß∂ ${n.name}</strong>\n        <div style=\"font-size:11px;color:#aaa;\">${n.description}</div>\n        <div style=\"margin-top:6px;display:flex;gap:6px;\">\n          <button onclick=\"insertNovelo('${n.id}')\">INSERIR NO MAPA</button>\n          <button class=\"secondary\" onclick=\"openNovelo('${n.id}')\">Abrir</button>\n          <button class=\"warning\" onclick=\"deleteNovelo('${n.id}')\">Excluir</button>\n        </div>\n      </div>\n    `).join(\"\");\n  }\n\n  // Exp√µe a fun√ß√£o para ser chamada pelo importProject do DevLog\n  window.renderNovelos = renderNovelos;\n\n  document.getElementById(\"novelo-create\").onclick = () => {\n    if (activeNovelo) {\n      alert(\"N√£o √© poss√≠vel criar novelo dentro de outro novelo.\");\n      return;\n    }\n\n    const name = document.getElementById(\"novelo-name\").value.trim();\n    if (!name) return;\n\n    // Adiciona ao global\n    (window.novelos || novelos).push({\n      id: Date.now().toString(),\n      name,\n      description: document.getElementById(\"novelo-desc\").value,\n      nodes: [],\n      connections: []\n    });\n\n    document.getElementById(\"novelo-name\").value = \"\";\n    document.getElementById(\"novelo-desc\").value = \"\";\n    renderNovelos();\n  };\n\n  /* ---------- INSERIR CARD ---------- */\n  window.insertNovelo = function (id) {\n    const n = (window.novelos || novelos).find(n => n.id === id);\n    if (!n) return;\n\n    const card = new Node(\n      canvas.width / 2 - 80,\n      canvas.height / 2 - 50,\n      `üß∂ ${n.name}`,\n      \"novelo\"\n    );\n\n    card.isNovelo = true;\n    card.noveloId = id;\n\n    nodes.push(card);\n    draw();\n  };\n\n  /* ---------- DESENROLAR ---------- */\n  window.openNovelo = function (id) {\n    const n = (window.novelos || novelos).find(n => n.id === id);\n    if (!n) return;\n\n    if (!mainMapBackup) {\n      mainMapBackup = {\n  nodes: nodes.map(n => ({\n    id: n.id,\n    x: n.x,\n    y: n.y,\n    label: n.label,\n    type: n.type,\n    description: n.description,\n    code: n.code,\n    isNovelo: n.isNovelo || false,\n    noveloId: n.noveloId || null\n  })),\n  connections: connections.map(c => ({\n    from: c.from.id,\n    to: c.to.id\n  }))\n};\n\n    }\n\n    nodes.length = 0;\n    connections.length = 0;\n\n    n.nodes.forEach(d => {\n      const node = new Node(d.x, d.y, d.label, d.type, d.id);\n      node.description = d.description;\n      node.code = d.code;\n      nodes.push(node);\n    });\n\n    n.connections.forEach(c => {\n      const from = nodes.find(n => n.id === c.from);\n      const to = nodes.find(n => n.id === c.to);\n      if (from && to) connections.push({ from, to });\n    });\n\n    activeNovelo = n;\n    showExitButton();\n    draw();\n  };\n\n  /* ---------- SAIR ---------- */\n  function showExitButton() {\n    if (document.getElementById(\"novelo-exit\")) return;\n\n    const btn = document.createElement(\"button\");\n    btn.id = \"novelo-exit\";\n    btn.textContent = \"‚ùå SAIR DO NOVELO\";\n    btn.style.cssText = `\n      position:absolute;\n      bottom:50px;\n      left:20px;\n      background:#b42318;\n      color:#fff;\n      padding:12px 18px;\n      border:none;\n      border-radius:6px;\n      z-index:50;\n    `;\n    btn.onclick = exitNovelo;\n\n    document.body.appendChild(btn);\n  }\n\n  function exitNovelo() {\n    activeNovelo.nodes = nodes.map(n => ({\n      id: n.id,\n      x: n.x,\n      y: n.y,\n      label: n.label,\n      type: n.type,\n      description: n.description,\n      code: n.code\n    }));\n\n    activeNovelo.connections = connections.map(c => ({\n      from: c.from.id,\n      to: c.to.id\n    }));\n\n    nodes.length = 0;\n    connections.length = 0;\n\n    mainMapBackup.nodes.forEach(d => {\n  const node = new Node(d.x, d.y, d.label, d.type, d.id);\n  node.description = d.description;\n  node.code = d.code;\n\n  // üîë RESTAURA IDENTIDADE DE NOVELO\n  if (d.isNovelo) {\n    node.isNovelo = true;\n    node.noveloId = d.noveloId;\n  }\n\n  nodes.push(node);\n});\n\n\n    mainMapBackup.connections.forEach(c => {\n      const from = nodes.find(n => n.id === c.from);\n      const to = nodes.find(n => n.id === c.to);\n      if (from && to) connections.push({ from, to });\n    });\n\n    mainMapBackup = null;\n    activeNovelo = null;\n\n    document.getElementById(\"novelo-exit\").remove();\n    draw();\n  }\n\n  /* ---------- EXCLUIR ---------- */\n  window.deleteNovelo = function (id) {\n    if (activeNovelo && activeNovelo.id === id) {\n      alert(\"Feche o novelo antes de excluir.\");\n      return;\n    }\n\n    // Atualiza a global novelos\n    if (window.novelos) {\n        window.novelos = window.novelos.filter(n => n.id !== id);\n        // Sincroniza refer√™ncia local se necess√°rio, embora n√£o deva ser pois usamos a global\n    }\n    \n    // Tamb√©m remove n√≥s que referenciam este novelo\n    nodes = nodes.filter(n => n.noveloId !== id);\n    \n    renderNovelos();\n    draw();\n  };\n\n})();\n</script>\n"
        },
        {
          "id": 1770110010841.924,
          "x": 1175,
          "y": 116,
          "label": "C√ìDIGO",
          "type": "js",
          "description": "Blocos de Script",
          "code": "<script>\n/* ===============================================\n   UNDO ‚Äî CTRL + Z \n================================================ */\n\n(function() {\n\n  // ----- ESTADO GLOBAL DO UNDO -----\n  const undoStack = [];\n  // Vari√°veis para capturar estado de movimento\n  let moveSnapshot = null;\n\n  // Registra uma a√ß√£o na pilha\n  function registerAction(action) {\n    // action = { type, description, undoFunc }\n    undoStack.push(action);\n    // Limita o tamanho da pilha se necess√°rio (opcional, ex: 50 a√ß√µes)\n    if (undoStack.length > 50) undoStack.shift();\n  }\n\n  // Mostra janela de desfazer\n  function showUndoDialog() {\n    if (undoStack.length === 0) {\n      alert(\"Nenhuma a√ß√£o para desfazer.\");\n      return;\n    }\n\n    // Remove overlay anterior se existir\n    const oldOverlay = document.getElementById(\"undo-overlay\");\n    if (oldOverlay) oldOverlay.remove();\n\n    // Criar overlay\n    const overlay = document.createElement(\"div\");\n    overlay.id = \"undo-overlay\";\n    overlay.style.cssText = `\n      position:fixed;\n      top:0; left:0; right:0; bottom:0;\n      background:rgba(0,0,0,0.6);\n      display:flex;\n      justify-content:center;\n      align-items:center;\n      z-index:9999;\n    `;\n\n    // Criar painel\n    const panel = document.createElement(\"div\");\n    panel.style.cssText = `\n      background:#252526;\n      padding:20px;\n      border-radius:8px;\n      width:400px;\n      max-height:80%;\n      overflow:auto;\n      color:#ccc;\n      font-family:'Segoe UI',sans-serif;\n      box-shadow: 0 10px 25px rgba(0,0,0,0.5);\n      border: 1px solid #444;\n    `;\n\n    const title = document.createElement(\"h3\");\n    title.innerText = \"Hist√≥rico de A√ß√µes\";\n    title.style.marginTop = \"0\";\n    title.style.color = \"#fff\";\n    title.style.borderBottom = \"1px solid #333\";\n    title.style.paddingBottom = \"10px\";\n    panel.appendChild(title);\n\n    const list = document.createElement(\"ul\");\n    list.style.listStyle = \"none\";\n    list.style.padding = \"0\";\n    list.style.margin = \"10px 0\";\n\n    // Renderiza a lista (Do mais recente para o mais antigo)\n    // Usamos clone da array para n√£o afetar a original no reverse\n    [...undoStack].reverse().forEach((action, idx) => {\n      const li = document.createElement(\"li\");\n      li.style.padding = \"8px 5px\";\n      li.style.borderBottom = \"1px solid #333\";\n      li.style.fontSize = \"13px\";\n      li.style.color = idx === 0 ? \"#fff\" : \"#999\"; // Destaque para o √∫ltimo\n      li.innerText = `${action.type} ${action.description ? '‚Äî ' + action.description : ''}`;\n      list.appendChild(li);\n    });\n\n    panel.appendChild(list);\n\n    // Bot√µes\n    const buttonsDiv = document.createElement(\"div\");\n    buttonsDiv.style.display = \"flex\";\n    buttonsDiv.style.justifyContent = \"flex-end\";\n    buttonsDiv.style.gap = \"10px\";\n    buttonsDiv.style.marginTop = \"15px\";\n\n    const undoBtn = document.createElement(\"button\");\n    undoBtn.innerText = \"‚Ü© Desfazer √öltima\";\n    undoBtn.style.background = \"#b42318\";\n    undoBtn.style.color = \"#fff\";\n    undoBtn.style.padding = \"8px 14px\";\n    undoBtn.style.border = \"none\";\n    undoBtn.style.borderRadius = \"4px\";\n    undoBtn.style.cursor = \"pointer\";\n    undoBtn.style.fontWeight = \"bold\";\n    \n    undoBtn.onclick = () => {\n      const action = undoStack.pop();\n      if (action && typeof action.undoFunc === \"function\") {\n        action.undoFunc();\n        \n        // Remove o item da lista visualmente\n        if (list.firstChild) list.removeChild(list.firstChild);\n        \n        // Feedback visual\n        draw(); \n        \n        // Fecha se acabar\n        if (undoStack.length === 0) {\n          overlay.remove();\n        }\n      }\n    };\n\n    const closeBtn = document.createElement(\"button\");\n    closeBtn.innerText = \"Fechar\";\n    closeBtn.style.background = \"#3c3c3c\";\n    closeBtn.style.color = \"#fff\";\n    closeBtn.style.padding = \"8px 14px\";\n    closeBtn.style.border = \"none\";\n    closeBtn.style.borderRadius = \"4px\";\n    closeBtn.style.cursor = \"pointer\";\n    closeBtn.onclick = () => {\n      overlay.remove();\n    };\n\n    buttonsDiv.appendChild(undoBtn);\n    buttonsDiv.appendChild(closeBtn);\n    panel.appendChild(buttonsDiv);\n\n    overlay.appendChild(panel);\n    document.body.appendChild(overlay);\n  }\n\n  // ----- INTEGRA√á√ÉO (WRAPPERS) -----\n\n  // 1. Adicionar N√≥\n  const originalAddNode = window.addNode;\n  window.addNode = function(...args) {\n    const initialLength = nodes.length;\n    originalAddNode(...args);\n    \n    // Verifica se realmente adicionou (usu√°rio pode ter cancelado o prompt)\n    if (nodes.length > initialLength) {\n      const addedNode = nodes[nodes.length - 1];\n      registerAction({\n        type: \"Adicionar n√≥\",\n        description: addedNode.label,\n        undoFunc: () => {\n          // Remove o n√≥ adicionado\n          const idx = nodes.indexOf(addedNode);\n          if (idx > -1) nodes.splice(idx, 1);\n          draw();\n        }\n      });\n    }\n  };\n\n  // 2. Deletar N√≥s (CORRIGIDO: Usa refer√™ncias reais para preservar conex√µes)\n  const originalDeleteSelectedNodes = window.deleteSelectedNodes;\n  window.deleteSelectedNodes = function(...args) {\n    if (selectedNodes.length === 0) return;\n\n    // Guarda REFER√äNCIAS aos objetos originais, n√£o c√≥pias\n    const nodesToSave = [...selectedNodes];\n    \n    // Guarda conex√µes que envolvem estes n√≥s antes que sejam destru√≠das\n    const connectionsToSave = connections.filter(c =>\n      nodesToSave.includes(c.from) || nodesToSave.includes(c.to)\n    );\n\n    originalDeleteSelectedNodes(...args);\n\n    registerAction({\n      type: \"Excluir n√≥(s)\",\n      description: nodesToSave.map(n => n.label).join(\", \"),\n      undoFunc: () => {\n        // Restaura os n√≥s originais para o array global\n        nodes.push(...nodesToSave);\n        \n        // Restaura as conex√µes (que ainda apontam para os objetos restaurados)\n        connections.push(...connectionsToSave);\n        \n        draw();\n      }\n    });\n  };\n\n  // 3. Conectar N√≥s\n  const originalConnectNodes = window.connectNodes;\n  window.connectNodes = function(...args) {\n    const countBefore = connections.length;\n    originalConnectNodes(...args);\n    \n    // Se houve adi√ß√£o\n    if (connections.length > countBefore) {\n      const newConn = connections[connections.length - 1];\n      registerAction({\n        type: \"Conectar n√≥s\",\n        description: `${newConn.from.label} ‚Üí ${newConn.to.label}`,\n        undoFunc: () => {\n          // Remove especificamente esta conex√£o\n          const idx = connections.indexOf(newConn);\n          if (idx > -1) connections.splice(idx, 1);\n          draw();\n        }\n      });\n    }\n  };\n\n  // 4. Desconectar (Unlink)\n  const originalUnlinkSelectedNodes = window.unlinkSelectedNodes;\n  window.unlinkSelectedNodes = function(...args) {\n    // Identifica quais links ser√£o removidos (entre os selecionados)\n    const linksToRemove = connections.filter(c =>\n      (selectedNodes.includes(c.from) && selectedNodes.includes(c.to)) ||\n      (selectedNodes.includes(c.to) && selectedNodes.includes(c.from))\n    );\n\n    if (linksToRemove.length === 0) {\n        originalUnlinkSelectedNodes(...args);\n        return;\n    }\n\n    originalUnlinkSelectedNodes(...args);\n\n    registerAction({\n      type: \"Desconectar n√≥s\",\n      description: `${linksToRemove.length} liga√ß√£o(√µes)`,\n      undoFunc: () => {\n        connections.push(...linksToRemove);\n        draw();\n      }\n    });\n  };\n\n  // 5. Movimento (CORRIGIDO: Snapshot no mousedown para evitar race condition)\n  // O evento mousedown deste script roda AP√ìS o do script principal (se inserido depois),\n  // portanto 'dragTarget' e 'selectedNodes' j√° estar√£o configurados pelo main.\n  \n  canvas.addEventListener(\"mousedown\", (e) => {\n      // Se o script principal detectou um alvo para arrastar\n      if (dragTarget) {\n          // Determina quais n√≥s est√£o sendo movidos\n          // L√≥gica do main: se dragTarget est√° na sele√ß√£o (e >1), move todos. Sen√£o, move s√≥ ele.\n          if (selectedNodes.includes(dragTarget) && selectedNodes.length > 1) {\n              moveSnapshot = selectedNodes.map(n => ({ node: n, startX: n.x, startY: n.y }));\n          } else {\n              moveSnapshot = [{ node: dragTarget, startX: dragTarget.x, startY: dragTarget.y }];\n          }\n      } else {\n          moveSnapshot = null;\n      }\n  });\n\n  canvas.addEventListener(\"mouseup\", () => {\n      if (moveSnapshot) {\n          // Verifica se houve deslocamento real em algum n√≥\n          const hasMoved = moveSnapshot.some(item => \n              item.node.x !== item.startX || item.node.y !== item.startY\n          );\n\n          if (hasMoved) {\n              // Cria closure com os dados do snapshot atual\n              const recordedSnapshot = [...moveSnapshot];\n              \n              registerAction({\n                  type: \"Mover n√≥(s)\",\n                  description: recordedSnapshot.length > 1 ? \"V√°rios n√≥s\" : recordedSnapshot[0].node.label,\n                  undoFunc: () => {\n                      // Restaura posi√ß√£o de todos os n√≥s envolvidos\n                      recordedSnapshot.forEach(item => {\n                          item.node.x = item.startX;\n                          item.node.y = item.startY;\n                      });\n                      draw();\n                  }\n              });\n          }\n          // Limpa snapshot\n          moveSnapshot = null;\n      }\n  });\n\n\n  // ----- HOTKEY CTRL + Z -----\n  window.addEventListener(\"keydown\", (e) => {\n    if (e.ctrlKey && e.key.toLowerCase() === \"z\") {\n      e.preventDefault();\n      showUndoDialog();\n    }\n  });\n\n})();\n</script>\n"
        },
        {
          "id": 1770110153832.585,
          "x": 1154,
          "y": 312,
          "label": "C√ìDIGO",
          "type": "js",
          "description": "Blocos de Script",
          "code": "<script>\n/* =========================================================\n   AUTONOMOUS SAVE STATE MONITOR\n   ========================================================= */\n(function () {\n\n  /* 1. LOCALIZAR O BOT√ÉO DE SALVAR (Incluindo Emoji üíæ) */\n  function findSaveButton() {\n    const buttons = document.querySelectorAll('button, a');\n    for (const el of buttons) {\n      const text = (el.innerText || '').toLowerCase();\n      const aria = (el.getAttribute('aria-label') || '').toLowerCase();\n      // Corre√ß√£o: Adicionado check para o emoji 'üíæ' usado no HTML\n      if (\n        text.includes('salv') ||\n        text.includes('save') ||\n        text.includes('üíæ') || \n        aria.includes('salv') ||\n        aria.includes('save')\n      ) {\n        return el;\n      }\n    }\n    return null;\n  }\n\n  const saveBtn = findSaveButton();\n  if (!saveBtn) {\n    console.warn('[SaveMonitor] Bot√£o salvar n√£o encontrado.');\n    return;\n  }\n\n  /* 2. ESTILOS VISUAIS (Mantidos) */\n  const style = document.createElement('style');\n  style.innerHTML = `\n    .save-layout-pending {\n      background-color: #f1c40f !important; /* Amarelo: Layout */\n      color: #000 !important;\n    }\n    .save-structure-pending {\n      background-color: #2ecc71 !important; /* Verde: Estrutura/Dados */\n      color: #000 !important;\n    }\n  `;\n  document.head.appendChild(style);\n\n  let state = null; // null | layout | structure\n\n  function reset() {\n    state = null;\n    saveBtn.classList.remove('save-layout-pending', 'save-structure-pending');\n  }\n\n  function markLayout() {\n    if (state === 'structure') return; // Estrutura tem prioridade\n    state = 'layout';\n    saveBtn.classList.add('save-layout-pending');\n  }\n\n  function markStructure() {\n    state = 'structure';\n    saveBtn.classList.remove('save-layout-pending');\n    saveBtn.classList.add('save-structure-pending');\n  }\n\n  /* 3. INTERCEPTA√á√ÉO DE FUN√á√ïES (Mecanismo Principal) \n     Como √© um app Canvas, MutationObserver n√£o funciona bem.\n     Interceptamos as fun√ß√µes globais que alteram o estado. */\n\n  const actions = [\n    'addNode', \n    'deleteSelectedNodes', \n    'connectNodes', \n    'unlinkSelectedNodes', \n    'toggleConnection'\n  ];\n\n  actions.forEach(fnName => {\n    if (typeof window[fnName] === 'function') {\n      const original = window[fnName];\n      window[fnName] = function (...args) {\n        const result = original.apply(this, args);\n        markStructure(); // Marca como alterado\n        return result;\n      };\n    }\n  });\n\n  /* 4. MONITORAMENTO DE INPUTS (Editor de C√≥digo/Descri√ß√£o) */\n  document.addEventListener('input', (e) => {\n    if (['TEXTAREA', 'INPUT', 'SELECT'].includes(e.target.tagName)) {\n       // Ignora input de arquivo\n       if (e.target.type === 'file') return;\n       markStructure();\n    }\n  });\n\n  /* 5. MONITORAMENTO DE CANVAS (Mudan√ßas de Posi√ß√£o/Layout) */\n  const canvas = document.getElementById('gameMap') || document.querySelector('canvas');\n  if (canvas) {\n    let startX = 0, startY = 0;\n    canvas.addEventListener('mousedown', (e) => {\n      startX = e.clientX;\n      startY = e.clientY;\n    });\n    canvas.addEventListener('mouseup', (e) => {\n      const dx = Math.abs(e.clientX - startX);\n      const dy = Math.abs(e.clientY - startY);\n      // Se moveu mais que 5 pixels, considera altera√ß√£o de layout\n      if (dx > 5 || dy > 5) {\n        markLayout();\n      }\n    });\n  }\n\n  /* 6. RESETAR AO SALVAR/CARREGAR */\n  \n  // Wrapper para Salvar\n  if (typeof window.exportProject === 'function') {\n    const origExport = window.exportProject;\n    window.exportProject = function (...args) {\n      origExport.apply(this, args);\n      setTimeout(reset, 200); // Reseta visualmente ap√≥s a√ß√£o\n    };\n  }\n\n  // Wrapper para Carregar (Importar)\n  if (typeof window.loadProjectData === 'function') {\n    const origLoad = window.loadProjectData;\n    window.loadProjectData = function (...args) {\n      origLoad.apply(this, args);\n      reset();\n    };\n  }\n\n  // Tecla Delete/Backspace detectada globalmente\n  document.addEventListener('keydown', e => {\n    if (e.key === 'Delete' || e.key === 'Backspace') {\n       // Pequeno delay para garantir que algo foi deletado\n       setTimeout(markStructure, 50);\n    }\n  });\n\n})();\n</script>"
        },
        {
          "id": 1770111038099.6694,
          "x": 649,
          "y": 463,
          "label": "C√ìDIGO",
          "type": "js",
          "description": "Blocos de Script",
          "code": "    \n<script>\n/* ================================\n   DEV LOG ‚Äî EXTENS√ÉO DO IDEOGRAMA\n================================ */\n\n(function () {\n\n  /* ---------- ESTADO ---------- */\n  // Removemos let devLogs = [] local para usar o global var devLogs\n  // let devLogs = [];\n\n  /* ---------- BOT√ÉO NA TOOLBAR ---------- */\n  const toolbar = document.getElementById(\"toolbar\");\n\n  const devBtn = document.createElement(\"button\");\n  devBtn.textContent = \"üìù\";\n  devBtn.className = \"secondary\";\n  devBtn.style.marginLeft = \"auto\";\n  devBtn.onclick = toggleDevLog;\n\n  toolbar.appendChild(devBtn);\n\n  /* ---------- PAINEL ---------- */\n  const panel = document.createElement(\"div\");\n  panel.id = \"devlog-panel\";\n  panel.style.cssText = `\n    position:absolute;\n    top:0;\n    right:-420px;\n    width:400px;\n    height:100vh;\n    background:#252526;\n    border-left:1px solid #333;\n    display:flex;\n    flex-direction:column;\n    transition:right .3s ease;\n    z-index:30;\n    box-shadow:-5px 0 15px rgba(0,0,0,.5);\n  `;\n\n  panel.innerHTML = `\n    <div style=\"padding:15px;background:#333;display:flex;justify-content:space-between;align-items:center;\">\n      <strong>DEV LOG</strong>\n      <button style=\"background:none;color:#fff;font-size:20px;\" onclick=\"document.getElementById('devlog-panel').style.right='-420px'\">√ó</button>\n    </div>\n\n    <div style=\"padding:10px;display:flex;gap:8px;\">\n      <select id=\"devlog-type\" style=\"\n        flex:1;\n        background:#1e1e1e;\n        color:#d4d4d4;\n        border:1px solid #3c3c3c;\n        padding:4px;\n      \">\n        <option value=\"manuten√ß√£o\">Manuten√ß√£o</option>\n        <option value=\"problema\">Problema</option>\n        <option value=\"atualiza√ß√£o\">Atualiza√ß√£o</option>\n      </select>\n      <button\n  id=\"devlog-save\"\n  class=\"success\"\n  style=\"background:#0e639c;\"\n  onmouseover=\"this.style.background='#1177bb'\"\n  onmouseout=\"this.style.background='#0e639c'\"\n>\n  GRAVAR\n</button>\n    </div>\n\n    <textarea id=\"devlog-text\" placeholder=\"O que foi feito no projeto?\"\n      style=\"margin:10px;height:90px;background:#1e1e1e;color:#ccc;border:none;padding:8px;\"></textarea>\n\n    <div id=\"devlog-history\" style=\"flex:1;overflow:auto;padding:10px;font-size:12px;\"></div>\n  `;\n\n  document.body.appendChild(panel);\n\n  /* ---------- FUN√á√ïES ---------- */\n  window.renderDevLogs = function() {\n      renderHistory();\n  }\n\n  function toggleDevLog() {\n    panel.style.right = panel.style.right === \"0px\" ? \"-420px\" : \"0px\";\n    renderHistory();\n  }\n\n  function saveLog() {\n    const text = document.getElementById(\"devlog-text\").value.trim();\n    if (!text) return;\n\n    const type = document.getElementById(\"devlog-type\").value;\n    const now = new Date();\n\n    devLogs.unshift({\n      date: now.toLocaleDateString(),\n      time: now.toLocaleTimeString(),\n      type,\n      text\n    });\n\n    document.getElementById(\"devlog-text\").value = \"\";\n    renderHistory();\n  }\n\n  function renderHistory() {\n    const box = document.getElementById(\"devlog-history\");\n\n    const colors = {\n      \"atualiza√ß√£o\": \"#2da042\", \n      \"problema\": \"#f85149\",    \n      \"manuten√ß√£o\": \"#d29922\"  \n    };\n\n    box.innerHTML = devLogs.map(log => {\n      const color = colors[log.type] || \"#0e639c\";\n\n      return `\n        <div style=\"\n          margin-bottom:10px;\n          border-left:4px solid ${color};\n          padding-left:8px;\n        \">\n          <div style=\"color:${color};font-weight:bold;\">\n            ${log.date} ${log.time} ‚Äî ${log.type}\n          </div>\n          <div style=\"color:#ccc;\">\n            ${log.text}\n          </div>\n        </div>\n      `;\n    }).join(\"\");\n  }\n\n  document.getElementById(\"devlog-save\").onclick = saveLog;\n\n  /* ---------- INTEGRA√á√ÉO COM EXPORT / IMPORT ---------- */\n\n  // Substituindo as fun√ß√µes globais para garantir que usem as vari√°veis 'var' corretamente.\n  window.exportProject = function () {\n    if (nodes.length === 0) return alert(\"Nada para salvar!\");\n\n    const projectData = {\n      version: \"1.1\",\n      nodes: nodes.map(n => ({\n        id: n.id,\n        x: n.x,\n        y: n.y,\n        label: n.label,\n        type: n.type,\n        description: n.description,\n        code: n.code,\n        // Persistir propriedades de novelo\n        isNovelo: n.isNovelo,\n        noveloId: n.noveloId\n      })),\n      connections: connections.map(c => ({\n        from: c.from.id,\n        to: c.to.id\n      })),\n      devLogs: devLogs,\n      // Persistir array global de novelos (Agora acess√≠vel via window.novelos ou var novelos)\n      novelos: window.novelos || novelos\n    };\n\n    const dataStr = \"data:text/json;charset=utf-8,\" +\n      encodeURIComponent(JSON.stringify(projectData, null, 2));\n\n    const a = document.createElement(\"a\");\n    a.href = dataStr;\n    a.download = \"arquitetura_jogo.json\";\n    a.click();\n  };\n\n  window.importProject = function (input) {\n    const file = input.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n          const data = JSON.parse(e.target.result);\n          // Chama a fun√ß√£o centralizada que limpa e popula as vari√°veis globais\n          loadProjectData(data);\n          renderHistory();\n      } catch(err) {\n          console.error(err);\n          alert(\"Erro ao importar arquivo.\");\n      }\n    };\n    reader.readAsText(file);\n  };\n\n})();\n</script>\n"
        },
        {
          "id": 1770108691674.3604,
          "x": 395,
          "y": 321,
          "label": "Unidades bases / ",
          "type": "txt",
          "description": "Sobre cart√µes",
          "code": "üóÇÔ∏è CART√ÉO\n\nO cart√£o se torna a unidade fundamental:\n\n- T√≠tulo\n- Descri√ß√£o\n- C√≥digo / texto\n- Conex√µes\n\nTudo no mapa √© constru√≠do a partir disso."
        },
        {
          "id": 1770108583691.6792,
          "x": 338,
          "y": 206,
          "label": "Modelo de n√≥s / ",
          "type": "txt",
          "description": "Sobre arquiettura",
          "code": "üß† DECIS√ÉO IMPORTANTE\n\nO projeto abandona listas e adota cart√µes conect√°veis.\n\nCada ideia vira um n√≥.\n\nA arquitetura passa a ser visual e naveg√°vel."
        },
        {
          "id": 1770112181419.2266,
          "x": 166,
          "y": 462,
          "label": "Feedback visual / ",
          "type": "txt",
          "description": "Sobre retorno visual",
          "code": "Foi adicionado um feedback visual pois percebi que uma anima√ß√£o cria um refor√ßo mental durante o processo de constru√ß√£o mental do mapa.\n\n"
        },
        {
          "id": 1770112489194.4233,
          "x": 167,
          "y": 574,
          "label": "C√ìDIGO",
          "type": "js",
          "description": "Blocos de Script",
          "code": "<script>\n/* =================================================\n   FEEDBACK VISUAL\n================================================= */\n\n(function () {\n\n  const effects = [];\n\n  window.playLinkEffect = function (from, to, type = \"link\") {\n    effects.push({ from, to, type, t: 0 });\n  };\n\n  function easeOutBack(t) {\n    const c1 = 1.70158;\n    const c3 = c1 + 1;\n    return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);\n  }\n\n  function drawEffects(ctx) {\n    for (let i = effects.length - 1; i >= 0; i--) {\n      const e = effects[i];\n      e.t += 0.05;\n\n      if (e.t >= 1) {\n        effects.splice(i, 1);\n        continue;\n      }\n\n      const x1 = e.from.x + e.from.width / 2;\n      const y1 = e.from.y + e.from.height / 2;\n      const x2 = e.to.x + e.to.width / 2;\n      const y2 = e.to.y + e.to.height / 2;\n\n      ctx.save();\n\n      if (e.type === \"link\") {\n        /* ===== NOVO LINK SNAP ===== */\n\n        const t = easeOutBack(e.t);\n\n        // Linha principal (aparece r√°pido)\n        ctx.strokeStyle = `rgba(0, 180, 255, ${1 - e.t})`;\n        ctx.lineWidth = 5;\n        ctx.shadowBlur = 15;\n        ctx.shadowColor = \"#00b4ff\";\n\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(\n          x1 + (x2 - x1) * Math.min(t, 1),\n          y1 + (y2 - y1) * Math.min(t, 1)\n        );\n        ctx.stroke();\n\n        // Flash de fixa√ß√£o nos n√≥s\n        if (e.t > 0.4) {\n          const pulse = (1 - e.t) * 12;\n\n          ctx.strokeStyle = `rgba(0,180,255,${1 - e.t})`;\n          ctx.lineWidth = 2;\n\n          ctx.beginPath();\n          ctx.arc(x1, y1, pulse, 0, Math.PI * 2);\n          ctx.stroke();\n\n          ctx.beginPath();\n          ctx.arc(x2, y2, pulse, 0, Math.PI * 2);\n          ctx.stroke();\n        }\n\n      } else {\n        /* ===== REMO√á√ÉO (MANTIDA) ===== */\n\n        const t = e.t;\n        const cx = (x1 + x2) / 2;\n        const cy = (y1 + y2) / 2;\n\n        ctx.strokeStyle = `rgba(255, 80, 80, ${1 - t})`;\n        ctx.lineWidth = 4;\n        ctx.setLineDash([10, 8]);\n\n        ctx.beginPath();\n        ctx.moveTo(\n          x1 + (cx - x1) * t,\n          y1 + (cy - y1) * t\n        );\n        ctx.lineTo(\n          x2 + (cx - x2) * t,\n          y2 + (cy - y2) * t\n        );\n        ctx.stroke();\n\n        ctx.setLineDash([]);\n\n        ctx.fillStyle = `rgba(255,80,80,${1 - t})`;\n        ctx.beginPath();\n        ctx.arc(cx, cy, 10 * (1 - t), 0, Math.PI * 2);\n        ctx.fill();\n      }\n\n      ctx.restore();\n    }\n  }\n\n  const originalDraw = window.draw;\n  window.draw = function () {\n    originalDraw();\n    drawEffects(ctx);\n    if (effects.length) requestAnimationFrame(draw);\n  };\n\n})();\n</script>"
        }
      ],
      "connections": [
        {
          "from": 1770110010841.924,
          "to": 1770109350358.047
        },
        {
          "from": 1770110153832.585,
          "to": 1770109129679.6843
        },
        {
          "from": 1770110274840.6711,
          "to": 1770109007896.298
        },
        {
          "from": 1770110471040.3567,
          "to": 1770109264969.4072
        },
        {
          "from": 1770110471040.3567,
          "to": 1770108486216.0203
        },
        {
          "from": 1770110471040.3567,
          "to": 1770108583691.6792
        },
        {
          "from": 1770110471040.3567,
          "to": 1770108691674.3604
        },
        {
          "from": 1770110471040.3567,
          "to": 1770109007896.298
        },
        {
          "from": 1770110471040.3567,
          "to": 1770109129679.6843
        },
        {
          "from": 1770110471040.3567,
          "to": 1770109350358.047
        },
        {
          "from": 1770110982675.0894,
          "to": 1770110471040.3567
        },
        {
          "from": 1770111038099.6694,
          "to": 1770110982675.0894
        },
        {
          "from": 1770108486216.0203,
          "to": 1770111159066.7163
        },
        {
          "from": 1770108583691.6792,
          "to": 1770111159066.7163
        },
        {
          "from": 1770108691674.3604,
          "to": 1770111159066.7163
        },
        {
          "from": 1770112181419.2266,
          "to": 1770108583691.6792
        },
        {
          "from": 1770112489194.4233,
          "to": 1770112181419.2266
        }
      ]
    }
  ]
}
